importScripts('https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js');
self.onmessage=async(ev)=>{const{pdf}=ev.data||{};if(!pdf)return;try{if(pdfjsLib.GlobalWorkerOptions){pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js';}const doc=await pdfjsLib.getDocument({data:pdf}).promise;const max=Math.min(doc.numPages,30);let text='';for(let i=1;i<=max;i++){const page=await doc.getPage(i);const content=await page.getTextContent();const items=content.items||[];const line=items.map(it=>(it.str||'')).join(' ');text+=(i>1?'\n\n':'')+line;}self.postMessage({text,meta:{pages:max}});}catch(e){self.postMessage({error:e?.message||String(e)});} };